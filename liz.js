// Generated by CoffeeScript 1.3.1
var createNamespaces, extractTemplates, findMatching, fs, glob, parser, path, select, sets, u;

glob = require('glob');

path = require('path');

select = require('soupselect').select;

parser = require('htmlparser');

u = require('util');

fs = require('fs');

sets = require('simplesets');

module.exports.findMatching = findMatching = function(basePath, pattern) {
  return glob.sync(pattern, {
    cwd: basePath
  }).map(function(file) {
    return path.join(basePath, file);
  });
};

module.exports.extractTemplates = extractTemplates = function(file) {
  var handler, templates;
  templates = {};
  handler = new parser.DefaultHandler(function(err, dom) {
    if (err) {
      u.debug(err);
    }
    return select(dom, 'template').forEach(function(template) {
      return templates[template.attribs.name] = template.children[0].raw.trim();
    });
  });
  parser = new parser.Parser(handler);
  parser.parseComplete(fs.readFileSync(file, 'utf-8'));
  return templates;
};

module.exports.createNamespaces = createNamespaces = function(names) {
  var nameSet, namespaces;
  nameSet = new sets.Set(names);
  namespaces = new sets.Set([]);
  nameSet.each(function(name) {
    var parts;
    parts = name.split('.');
    return parts.reduce(function(ns, part) {
      ns.push(part);
      namespaces.add(ns.join('.'));
      return ns;
    }, []);
  });
  return namespaces.array().sort();
};
